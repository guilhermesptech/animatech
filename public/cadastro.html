<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar-se no Toon</title>
    <link rel="stylesheet" href="css/cadastro.css">
    <script src="js/sessao.js"></script>
</head>

<body>
    <header>
        <nav class="container-navegacao">
            <div class="logotipo">
                <img src="assets/logotipo.png" width="40px" alt="Logotipo">
            </div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="sobre-mim.html">Sobre mim</a></li>
                <li><a href="login.html">Entrar</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>
        <h1>Criar uma nova conta</h1>
        <div class="container-cadastro">
            <div class="container-nome-sobrenome-data_nascimento-genero-email-senha-cadastrar">
                <div class="container-nome-sobrenome">
                    <input type="text" id="input_nome" placeholder="Nome" required />
                    <input type="text" id="input_sobrenome" placeholder="Sobrenome" required />
                </div>
                <div class="container-data_nascimento-select-genero-sexo">
                    <p>Data de nascimento</p>
                    <div class="container-select-genero">
                        <select id="select_dia">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                        </select>

                        <select id="select_mes">
                            <option value="01">jan</option>
                            <option value="02">fev</option>
                            <option value="03">mar</option>
                            <option value="04">abr</option>
                            <option value="05">mai</option>
                            <option value="06">jun</option>
                            <option value="07">jul</option>
                            <option value="08">ago</option>
                            <option value="09">set</option>
                            <option value="10">out</option>
                            <option value="11">nov</option>
                            <option value="12">dez</option>
                        </select>

                        <select id="select_ano">
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="2018">2018</option>
                            <option value="2017">2017</option>
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                            <option value="2014">2014</option>
                            <option value="2013">2013</option>
                            <option value="2012">2012</option>
                            <option value="2011">2011</option>
                            <option value="2010">2010</option>
                            <option value="2009">2009</option>
                            <option value="2008">2008</option>
                            <option value="2007">2007</option>
                            <option value="2006">2006</option>
                            <option value="2005">2005</option>
                            <option value="2004">2004</option>
                            <option value="2003">2003</option>
                            <option value="2002">2002</option>
                            <option value="2001">2001</option>
                            <option value="2000">2000</option>
                            <option value="1999">1999</option>
                            <option value="1998">1998</option>
                            <option value="1997">1997</option>
                            <option value="1996">1996</option>
                            <option value="1995">1995</option>
                            <option value="1994">1994</option>
                            <option value="1993">1993</option>
                            <option value="1992">1992</option>
                            <option value="1991">1991</option>
                            <option value="1990">1990</option>
                            <option value="1989">1989</option>
                            <option value="1988">1988</option>
                            <option value="1987">1987</option>
                            <option value="1986">1986</option>
                            <option value="1985">1985</option>
                            <option value="1984">1984</option>
                            <option value="1983">1983</option>
                            <option value="1982">1982</option>
                            <option value="1981">1981</option>
                            <option value="1980">1980</option>
                            <option value="1979">1979</option>
                            <option value="1978">1978</option>
                            <option value="1977">1977</option>
                            <option value="1976">1976</option>
                            <option value="1975">1975</option>
                            <option value="1974">1974</option>
                            <option value="1973">1973</option>
                            <option value="1972">1972</option>
                            <option value="1971">1971</option>
                            <option value="1970">1970</option>
                        </select>
                    </div>
                </div>
                <div class="container-data_nascimento-select-genero-sexo">
                    <p>Gênero</p>
                    <div class="container-select-genero">
                        <div class="container-sexo">
                            Feminino
                            <input type="radio" name="genero" value="f" />
                        </div>
                        <div class="container-sexo">
                            Masculino
                            <input type="radio" name="genero" value="m" />
                        </div>
                        <div class="container-sexo">
                            Um outro
                            <input type="radio" name="genero" value="o" />
                        </div>
                    </div>
                </div>
                <div class="container-usuario-email-senha">
                    <input type="text" id="input_usuario" placeholder="Nome de usuário" required />
                </div>
                <div class="container-usuario-email-senha">
                    <input type="email" id="input_email" placeholder="Email" required />
                </div>
                <div class="container-usuario-email-senha">
                    <input type="password" id="input_senha" placeholder="Senha" required />
                </div>

                <div class="container-cadastrar">
                    <a onclick="cadastrar()">Cadastre-se</a>
                </div>
                <div class="container-entrar">
                    <a href="login.html">Já tem uma conta?</a>
                </div>
            </div>
        </div>
    </main>
</body>

</html>
<script>
    function cadastrar() {

        var nomeVar = input_nome.value;
        var sobrenomeVar = input_sobrenome.value;
        var dataNascimentoVar = `${select_ano.value}-${select_mes.value}-${select_dia.value}`;
        var generoVar = document.querySelector('input[name="genero"]:checked')?.value;
        var usuarioVar = input_usuario.value;
        var emailVar = input_email.value;
        var senhaVar = input_senha.value;

        console.log
            (
                "Nome " + nomeVar + "\n",
                "Sobrenome " + sobrenomeVar + "\n",
                "Data de nascimento " + dataNascimentoVar + "\n",
                "Gênero " + generoVar + "\n",
                "Usuário " + usuarioVar + "\n",
                "E-mail " + emailVar + "\n",
                "Senha " + senhaVar + "\n"
            )

        if
            (
            nomeVar == "" ||
            sobrenomeVar == "" ||
            dataNascimentoVar == "" ||
            generoVar == "" ||
            usuarioVar == "" ||
            emailVar == "" ||
            senhaVar == ""
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
            finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000);
        }

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nome: nomeVar,
                sobrenome: sobrenomeVar,
                dataNascimento: dataNascimentoVar,
                genero: generoVar,
                usuario: usuarioVar,
                email: emailVar,
                senha: senhaVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none";
    }

</script>